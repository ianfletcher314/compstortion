<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compstortion - Guitar Pedal</title>
  <link rel="stylesheet" href="css/pedal.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- Welcome Screen -->
  <div id="welcome-screen" class="welcome-screen">
    <div class="welcome-content">
      <h1 class="welcome-title">Compstortion</h1>
      <p class="welcome-subtitle">Web-based guitar effects pedalboard</p>
      <div class="welcome-buttons">
        <div class="welcome-login">
          <input type="email" id="welcome-email" class="welcome-input" placeholder="Enter your email...">
          <button id="welcome-login-btn" class="welcome-btn welcome-btn-primary">Login to Save Presets</button>
        </div>
        <div class="welcome-divider"><span>or</span></div>
        <button id="welcome-guest-btn" class="welcome-btn welcome-btn-secondary">Continue as Guest</button>
      </div>
      <p id="welcome-message" class="welcome-message" style="display: none;"></p>
    </div>
  </div>

  <!-- Settings Drawer -->
  <div id="settings-drawer" class="settings-drawer">
    <div class="drawer-header">
      <h3>Settings</h3>
      <button id="drawer-close" class="drawer-close">&times;</button>
    </div>
    <div class="drawer-content">
      <div id="drawer-logged-out" class="drawer-section">
        <h4>Account</h4>
        <p class="drawer-text">Login to save and load your presets across devices.</p>
        <input type="email" id="drawer-email" class="drawer-input" placeholder="Enter your email...">
        <button id="drawer-login-btn" class="drawer-btn">Send Login Link</button>
        <p id="drawer-message" class="drawer-message" style="display: none;"></p>
      </div>
      <div id="drawer-logged-in" class="drawer-section" style="display: none;">
        <h4>Account</h4>
        <p class="drawer-text">Logged in as <span id="drawer-user-email"></span></p>
        <button id="drawer-logout-btn" class="drawer-btn drawer-btn-secondary">Logout</button>
      </div>
      <div id="drawer-presets" class="drawer-section" style="display: none;">
        <h4>Presets</h4>
        <div class="drawer-preset-save">
          <input type="text" id="preset-name" class="drawer-input" placeholder="Preset name...">
          <button id="save-preset-btn" class="drawer-btn">Save Current</button>
        </div>
        <div class="drawer-preset-load">
          <select id="preset-select" class="drawer-select">
            <option value="">Load a preset...</option>
          </select>
          <button id="delete-preset-btn" class="drawer-btn drawer-btn-danger">Delete</button>
        </div>
      </div>
    </div>
  </div>
  <div id="drawer-overlay" class="drawer-overlay"></div>

  <!-- Settings Button -->
  <button id="settings-btn" class="settings-btn" style="display: none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="3"></circle>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
    </svg>
  </button>

  <div id="main-app" class="container" style="display: none;">
    <h1 class="title">Compstortion</h1>

    <div class="pedal-board">
      <!-- Compressor 1 -->
      <div class="pedal" id="comp1">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Comp 1</h2>

        <div class="led-container">
          <div class="led compressor-led" id="led-comp1"></div>
        </div>

        <div class="gr-meter" id="gr-meter-comp1">
          <div class="gr-label">GR</div>
          <div class="gr-bars">
            <div class="gr-bar" data-db="1"></div>
            <div class="gr-bar" data-db="2"></div>
            <div class="gr-bar" data-db="4"></div>
            <div class="gr-bar" data-db="6"></div>
            <div class="gr-bar" data-db="8"></div>
            <div class="gr-bar" data-db="10"></div>
            <div class="gr-bar" data-db="15"></div>
            <div class="gr-bar" data-db="20"></div>
          </div>
          <div class="gr-scale">
            <span>1</span><span>4</span><span>10</span><span>20</span>
          </div>
        </div>

        <div class="knobs knobs-6">
          <div class="knob-group">
            <div class="knob" data-param="threshold" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Thresh</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="ratio" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Ratio</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="attack" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Attack</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="release" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Release</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="level" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Level</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="blend" data-pedal="comp1">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Blend</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="comp1" aria-label="Toggle Compressor 1">
            <span class="footswitch-label">1</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>

      <!-- Distortion -->
      <div class="pedal" id="distortion">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Distortion</h2>

        <div class="led-container">
          <div class="led" id="led-distortion"></div>
        </div>

        <div class="type-selector" id="distortion-type-selector" title="Click to change type (D key)">
          <span class="type-label">TYPE</span>
          <span class="type-display" id="distortion-type-display">TS9</span>
          <span class="type-arrows">&#8592; &#8594;</span>
        </div>

        <div class="knobs">
          <div class="knob-group">
            <div class="knob" data-param="drive" data-pedal="distortion">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Drive</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="tone" data-pedal="distortion">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Tone</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="level" data-pedal="distortion">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Level</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="distortion" aria-label="Toggle Distortion">
            <span class="footswitch-label">2</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>

      <!-- Modulation -->
      <div class="pedal" id="modulation">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Modulation</h2>

        <div class="led-container">
          <div class="led" id="led-modulation"></div>
        </div>

        <div class="type-selector" id="mod-type-selector" title="Click to change type (M key)">
          <span class="type-label">TYPE</span>
          <span class="type-display" id="mod-type-display">PHASE</span>
          <span class="type-arrows">&#8592; &#8594;</span>
        </div>

        <div class="knobs">
          <div class="knob-group">
            <div class="knob" data-param="rate" data-pedal="modulation">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Rate</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="depth" data-pedal="modulation">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Depth</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="blend" data-pedal="modulation">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Blend</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="modulation" aria-label="Toggle Modulation">
            <span class="footswitch-label">3</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>

      <!-- Reverb -->
      <div class="pedal" id="reverb">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Reverb</h2>

        <div class="led-container">
          <div class="led" id="led-reverb"></div>
        </div>

        <div class="type-selector" id="reverb-type-selector" title="Click to change type (R key)">
          <span class="type-label">TYPE</span>
          <span class="type-display" id="reverb-type-display">SPRING</span>
          <span class="type-arrows">&#8592; &#8594;</span>
        </div>

        <div class="knobs">
          <div class="knob-group">
            <div class="knob" data-param="decay" data-pedal="reverb">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Decay</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="tone" data-pedal="reverb">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Tone</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="blend" data-pedal="reverb">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Blend</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="reverb" aria-label="Toggle Reverb">
            <span class="footswitch-label">4</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>

      <!-- Compressor 2 -->
      <div class="pedal" id="comp2">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Comp 2</h2>

        <div class="led-container">
          <div class="led compressor-led" id="led-comp2"></div>
        </div>

        <div class="gr-meter" id="gr-meter-comp2">
          <div class="gr-label">GR</div>
          <div class="gr-bars">
            <div class="gr-bar" data-db="1"></div>
            <div class="gr-bar" data-db="2"></div>
            <div class="gr-bar" data-db="4"></div>
            <div class="gr-bar" data-db="6"></div>
            <div class="gr-bar" data-db="8"></div>
            <div class="gr-bar" data-db="10"></div>
            <div class="gr-bar" data-db="15"></div>
            <div class="gr-bar" data-db="20"></div>
          </div>
          <div class="gr-scale">
            <span>1</span><span>4</span><span>10</span><span>20</span>
          </div>
        </div>

        <div class="knobs knobs-6">
          <div class="knob-group">
            <div class="knob" data-param="threshold" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Thresh</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="ratio" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Ratio</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="attack" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Attack</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="release" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Release</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="level" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Level</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="blend" data-pedal="comp2">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Blend</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="comp2" aria-label="Toggle Compressor 2">
            <span class="footswitch-label">5</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>

      <!-- Amp -->
      <div class="pedal amp-pedal" id="amp">
        <div class="pedal-top">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>

        <h2 class="pedal-name">Amp</h2>

        <div class="led-container">
          <div class="led" id="led-amp"></div>
        </div>

        <div class="type-selector" id="amp-type-selector" title="Click to change amp (A key)">
          <span class="type-label">AMP</span>
          <span class="type-display" id="amp-type-display">CLEAN</span>
          <span class="type-arrows">&#8592; &#8594;</span>
        </div>

        <div class="knobs knobs-6">
          <div class="knob-group">
            <div class="knob" data-param="gain" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Gain</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="bass" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Bass</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="mid" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Mid</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="midfreq" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Mid Freq</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="treble" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Treble</label>
          </div>
          <div class="knob-group">
            <div class="knob" data-param="master" data-pedal="amp">
              <div class="knob-inner">
                <div class="knob-indicator"></div>
              </div>
            </div>
            <label>Master</label>
          </div>
        </div>

        <div class="footswitch-container">
          <button class="footswitch" data-pedal="amp" aria-label="Toggle Amp">
            <span class="footswitch-label">6</span>
          </button>
        </div>

        <div class="pedal-bottom">
          <div class="screw"></div>
          <div class="screw"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="start-audio" class="start-button">Start Audio</button>
      <select id="input-select" class="input-select" disabled>
        <option value="">Select Input Device</option>
      </select>
    </div>

    <div class="instructions">
      <p>Connect your guitar via USB interface, click "Start Audio", then use footswitches (or keys 1-6) to toggle effects. Press D/A/M/R to cycle distortion/amp/modulation/reverb types.</p>
    </div>
  </div>

  <script src="js/main.js" type="module"></script>
</body>
</html>
